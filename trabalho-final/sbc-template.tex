\documentclass[12pt]{article}

\usepackage{sbc-template}

\usepackage{graphicx,url}

%\usepackage[brazil]{babel}
\usepackage[latin1]{inputenc}
\usepackage{nicefrac}
% Change paragraph identation
\setlength{\parindent}{.8cm}
\usepackage{indentfirst}
\newcommand{\etal}{\textit{et. al}}
\usepackage{float}



\sloppy

\title{Classifica��o da nota de reda��o na base de microdados do ENEM 2012 utilizando o algoritmo \emph{k-Nearest Neighbors}}

\author{Jonathan Coutinho Luz de Queiroz\inst{1} \\ Guilherme Lima Bernal\inst{1}}
\address{Instituto de Matem�tica -- Universidade Federal da Bahia (UFBA)
\email{jonathanqueiroz@dcc.ufba.br}
}

\newcommand{\reffig}[1]{Fig.~\ref{fig:#1}}
\newcommand{\reftab}[1]{Tabela~\ref{tab:#1}}

\geometry{lmargin=2.2cm, rmargin=2.2cm, tmargin=2.2cm, bmargin=2.2cm}
\setlength\tabcolsep{4pt}
\begin{document}

\maketitle

\begin{resumo}
Neste trabalho, tomamos como base o algoritmo k-Nearest Neighbors (k-NN) para a predi��o da nota de reda��o na base de microdados do ENEM 2012.
O primeiro passo consistiu na realiza��o de uma an�lise estat�stica sobre a base de dados.
Em seguida, preparamos a base para a aplica��o do algoritmo de classifica��o.
Depois disso, amparados na an�lise estat�stica previamente realizada, desenvolvemos uma vers�o inicial do algoritmo de classifica��o.
Finalmente, refinamos o algoritmo desenvolvido atrav�s de experimentos e analisamos a sua acur�cia.
\end{resumo}

%\section{Introdu��o}
%TODO: write an introduction

\section{An�lise estat�stica}
O primeiro passo da an�lise estat�stica consistiu no estudo isolado dos principais atributos da base (idade, sexo, regi�o, localiza��o, tipo de escola e nota de reda��o).
%Em seguida, foi feita uma compara��o entre as idades e as notas de reda��o dos candidatos de cada regi�o do pa�s.
%Finalmente, analisamos a correla��o entre a nota de reda��o e diversos outros atributos (idade, sexo, tipo de escola, localiza��o, ano de conclus�o do Ensino M�dio, notas nas demais provas, defici�ncia mental e defici�ncia f�sica).
Em seguida, analisamos a correla��o entre a nota de reda��o e diversos outros atributos (idade, sexo, tipo de escola, tipo de localiza��o, ano de conclus�o do Ensino M�dio, notas nas demais provas, defici�ncia mental e defici�ncia f�sica).

Como o objetivo final deste trabalho foi o desenvolvimento de um algoritmo de predi��o da nota de reda��o, descartamos os candidatos que n�o fizeram essa prova (14.672 dentre 50.000).
Em seguida, removemos dois \emph{outliers} de acordo com a idade: um candidato de 7 anos e outro de 114 anos.
Ap�s a remo��o desses dois candidatos, a idade passou a variar entre 12 e 70 anos (inclusive), o que indica que os dois registros removidos est�o incorretos.
Ainda que n�o estejam, no entanto, a remo��o de dois registros dentre mais de 30.000 � estatisticamente insignificamente e � justificada pela melhoria que isso proporciona na visualiza��o dos gr�ficos.\footnote{Antes da remo��o desses dois registros, mais de $\nicefrac{1}{3}$ da �rea do histograma de idades era ocupado por valores de 70 a 114, mesmo havendo apenas um registro com valor nessa faixa.}
Restaram 35.326 candidatos.
% TODO: move to introduction?

\subsection{An�lise de correla��es}
Finalmente, elegemos alguns atributos para avaliar a exist�ncia de poss�veis correla��es com as notas de reda��o.
Os resultados s�o apresentados a seguir.

\subsubsection{Idade}
%TODO: melhorar essa imagem
A \reffig{correlacao-idade} apresenta as notas de reda��o em fun��o da idade dos candidatos e aponta para a inexist�ncia de correla��o significativa entre esses dois atributos.
De fato, o coeficiente de correla��o de Pearson entre essas duas vari�veis vale aproximadamente $-0.11$, o que confirma essa hip�tese.

\begin{figure}[H]
\centering\includegraphics[width=.5\linewidth]{../correlacao_idade.png}
\caption{Notas de reda��o em fun��o da idade.}
\label{fig:correlacao-idade}
\end{figure}

\subsubsection{Sexo}
A \reffig{correlacao-sexo} indica que a diferen�a de desempenho entre candidatos do sexo masculino e do sexo feminino � pequena.

\begin{figure}[H]
\centering\includegraphics[width=.5\linewidth]{../correlacao_sexo.png}
\caption{Distribui��o das notas de reda��o para candidatos de cada sexo.}
\label{fig:correlacao-sexo}
\end{figure}

\subsubsection{Tipo de escola}
A \reffig{correlacao-escola} evidencia uma associa��o entre a nota da reda��o e o tipo da escola na qual o candidato estudou.
Mais especificamente, estudantes de escolas particulares tendem a obter notas mais altas.
%TODO: ineflizmente, naoad pra usar iso na predicao porque...

\begin{figure}[H]
\centering\includegraphics[width=.5\linewidth]{../correlacao_escola.png}
\caption{Distribui��o das notas de reda��o para estudantes de escolas p�blicas e de escolas privadas.}
\label{fig:correlacao-escola}
\end{figure}

\subsubsection{Localiza��o}
A \reffig{correlacao-localizacao} evidencia uma associa��o entre a nota da reda��o e a localiza��o do candidato (zona urbana ou zona rural).
Mais especificamente, candidatos da zona urbana tendem a obter notas mais altas.
Na subse��o~\ref{subsec:estatisticas-gerais}, mostramos que, dentre os candidatos que informaram a localiza��o, a enorme maioria vive na zona urbana.
A semelhan�a, na \reffig{correlacao-localizacao}, entre os gr�ficos dos candidatos que vivem na zona urbana e dos candidatos que n�o informaram a localiza��o � um poss�vel ind�cio de que a maioria dos candidatos que n�o informaram localiza��o tamb�m vive na zona urbana.

\begin{figure}[H]
\centering\includegraphics[width=.44\linewidth]{../correlacao_localizacao.png}
\caption{Distribui��o das notas de reda��o para estudantes da zona urbana e da zona rural.}
\label{fig:correlacao-localizacao}
\end{figure}

\subsubsection{Ano de conclus�o do Ensino M�dio}
A \reffig{correlacao-ano-concluiu} aponta para a inexist�ncia de correla��o significativa entre a nota da reda��o e o ano no qual o candidato concluiu o Ensino M�dio.\footnote{O valor ``.'' indica que o ano de conclus�o do Ensino M�dio n�o foi informado.}
\begin{figure}[H]
\centering\includegraphics[width=.44\linewidth]{../correlacao_ano_concluiu.png}
\caption{Distribui��o das notas de reda��o em fun��o do ano de conclus�o do Ensino M�dio.}
\label{fig:correlacao-ano-concluiu}
\end{figure}

\subsubsection{Notas nas demais provas}
As Figuras~\ref{fig:correlacao-nota-ch}--\ref{fig:correlacao-nota-mt} apresentam uma forte evid�ncia da exist�ncia de correla��o positiva entre as notas obtidas pelos candidatos em reda��o e nas demais provas.
De fato, os coeficientes de correla��o de Pearson apresentados na \reftab{coeficiente-pearson-por-prova} confirmam essa hip�tese.
Ainda de acordo com a \reftab{coeficiente-pearson-por-prova}, a maior correla��o ocorre com as provas de Ci�ncias Humanas e Linguagens e C�digos.
%TODO: footnote dizendo que foram desconsiderados candidatos que faltaram

\begin{minipage}{.5\textwidth}
    \begin{figure}[H]
    \centering\includegraphics[width=.86\linewidth]{../correlacao_nota_ch.png}
    \caption{Notas de reda��o em fun��o das notas em Ci�ncias Humanas.}
    \label{fig:correlacao-nota-ch}
    \end{figure}
\end{minipage}%
\begin{minipage}{.5\textwidth}
    \begin{figure}[H]
    \centering\includegraphics[width=.86\linewidth]{../correlacao_nota_cn.png}
    \caption{Notas de reda��o em fun��o das notas em Ci�ncias da Natureza.}
    \label{fig:correlacao-nota-cn}
    \end{figure}
\end{minipage}

\begin{minipage}{.5\textwidth}
    \begin{figure}[H]
    \centering\includegraphics[width=.86\linewidth]{../correlacao_nota_lc.png}
    \caption{Notas de reda��o em fun��o das notas em Linguagens e C�digos.}
    \label{fig:correlacao-nota-lc}
    \end{figure}
\end{minipage}%
\begin{minipage}{.5\textwidth}
    \begin{figure}[H]
    \centering\includegraphics[width=.86\linewidth]{../correlacao_nota_mt.png}
    \caption{Notas de reda��o em fun��o das notas em Matem�tica.}
    \label{fig:correlacao-nota-mt}
    \end{figure}
\end{minipage}

\begin{table}[H]
\centering\begin{tabular}{ c c }
  \textbf{Prova}       & \textbf{Coeficiente de correla��o} \\
  Ci�ncias Humanas     & 0.54 \\
  Ci�ncias da Natureza & 0.48 \\
  Linguagens e C�digos & 0.54 \\
  Matem�tica           & 0.46 \\
\end{tabular}
\caption{Coeficiente de correla��o de Pearson entre as notas obtidas pelos candidatos em reda��o e em cada uma das outras provas.}
\label{tab:coeficiente-pearson-por-prova}
\end{table}

\section{Pr�-processamento}
Nesta etapa, preparamos a base de dados para utiliza��o no algoritmo de classifica��o.
Optamos por remover colunas majoritariamente por raz�es t�cnicas (n�mero de identifica��o do candidato, por exemplo, al�m de outros campos descritos a seguir). Consequentemente, colunas que simplesmente suspeit�vamos serem poucos relevantes para a classifica��o, devido � an�lise estat�stica previamente realizada, foram mantidas.
Essa abordagem permitiu que a an�lise estat�stica atuasse como um guia durante o desenvolvimento do algoritmo de classifica��o, ao inv�s de determinar completamente os atributos nele utilizados.

De forma geral, atributos num�ricos foram mapeados para um subintervalo de [0, 1] de forma a torn�-los aproximadamente igualmente relevantes para a classifica��o, pelo menos a princ�pio.
Caso isso n�o fosse feito, atributos associados a intervalos de valores mais amplos (particularmente as notas nas provas objetivas) execeriam maior influ�ncia que os demais.
Similarmente, atributos qualitativos nominais com $C > 2$ categorias foram separados em $C$ atributos booleanos.
Isso foi feito porque a atribui��o arbitr�ria de valores num�ricos a cada uma das categorias induziria uma ordena��o indevida entre essas categorias.
As opera��es realizadas durante a normaliza��o s�o descritas mais detalhadamente a seguir.

\begin{itemize}
    \item Foi criada a coluna UF\_INSC\_IGUAL\_PROVA, que guarda ``1'' se UF\_INSC for igual ao UF\_MUNICIPIO\_PROVA, indicando que o candidato n�o mudou de estado para fazer a prova. ``0'' caso contr�rio.
    \item UF\_INSC foi expandido para um total de 26 colunas, cada uma contendo ``1'' ou ``0'' para indicar se o candidato fez a prova nesse estado ou n�o. Nenhum candidato poder ter mais de um estado marcado como ``1''. Informa��es adicionais sobre a localiza��o do candidato (nome do munic�pio, c�digo do munic�cio, etc.) foram removidas.
    \item De forma similar, TP\_SEXO foi expandido para duas colunas: GENERO\_HOMEM e GENERO\_MULHER, com apenas uma delas sendo marcada como ``1''.
    \item As colunas NOTA\_CN, NOTA\_CH, NOTA\_LC e NOTA\_MT passaram a guardar a nota do candidato em cada uma das provas. Para que o valor fosse consistente de 0 a 1, essa nota foi dividida por 1000.
    \item V�rias colunas que guardavam as op��es marcadas pelo candidato, gabarito, identifica��o da prova e afins foram removidas por serem irrelevantes para obten��o do resultado.
    \item A coluna TP\_ESCOLA foi expandida para duas colunas: ESCOLA\_PUBLICA e ESCOLA\_PRIVADA. Para a maioria dos candidatos, o tipo de escola n�o foi informado, e portanto ambas as colunas ficaram com valor falso. Demais informa��es sobre a escola e a entidade certificadora do candidato (nome, munic�pio, etc.) foram removidas.
    Analogamente, a coluna  ID\_LOCALIZACAO foi expandida para duas colunas: LOCALIZACAO\_URBANA e LOCALIZACAO\_RURAL. Para a maioria dos candidatos, o tipo de localiza��o n�o foi informado, e portanto ambas as colunas ficaram com valor falso.
    \item A idade foi normalizada para valores de 0 a 1 atrav�s de uma divis�o por 100. Dessa forma, a menor idade passou a ser 0.12 e a maior idade passou a ser 0.70.
    \item TP\_COR\_RACA foi dividido em 5 colunas, uma com cada cor/ra�a. Cada uma possui ``1'' se ela � verdadeira para o candidato. Nenhum candidato tem duas dessas colunas como verdadeiras.
    \item Analogamente, TP\_ESTADO\_CIVIL foi dividido em 4 colunas booleanas: ESTADO\_CIVIL\_SOLTEIRO, ESTADO\_CIVIL\_CASADO, ESTADO\_CIVIL\_DIVORCIADO e ESTADO\_CIVIL\_VIUVO.
    \item ST\_CONCLUSAO foi dividido em 4 colunas seguindo o mesmo princ�pio: ENSINO\_MEDIO\_CONCLUIDO (alunos que j� haviam conclu�do o Ensino M�dio quando a prova foi aplicada), ENSINO\_MEDIO\_EM\_2012 (alunos que estavam concluindo o Ensimo M�dio no mesmo ano de aplica��o da prova), ENSINO\_MEDIO\_DEPOIS\_2012 (alunos que s� concluir�am o Ensino M�dio em anos posteriores � aplica��o da prova) e ENSINO\_MEDIO\_NAO\_FAZ (alunos que nem haviam conclu�do previamente nem estavam cursando o Ensino M�dio). O ano exato de conclus�o do Ensino M�dio, quando informado, foi descartado.
\end{itemize}

\section{Classifica��o}
O objetivo final do trabalho foi a classifica��o dos candidatos em quatro classes, de acordo com a nota obtida na prova de reda��o: ``ruim'', ``regular'', ``boa'' e ``�tima''.
A determina��o da classe de cada candidato foi feita atrav�s da divis�o do dataset original em quartis: candidatos no primeiro quartil foram classificados como �timos, candidatos no segundo quartil como bons, e assim por diante.
Esse processo resulta em uma divis�o equitativa dos candidatos em classes, e consequentemente simplifica uma avalia��o justa do algoritmo de classifica��o desenvolvido.

O algoritmo de classifica��o utilizado foi o \emph{k-Nearest Neighbors} (\emph{k-NN}).
Durante o treinamento desse algoritmo, todas as observa��es do conjunto de treinamento s�o convertidas em vetores no espa�o de caracter�sticas.
(Por isso, � importante que a etapa de pr�-processamento gere apenas atributos num�ricos.)
Depois disso, sempre que uma nova observa��o precisa ser classificada, s�o identificadas as $k$ observa��es mais pr�ximas dela no conjunto de treinamento (no nosso caso, de acordo com a dist�ncia de Euclides).
A classe predita � simplesmente a classe mais frequente dentre essas $k$ observa��es.
Em todos os experimentos realizados, utilizamos $\nicefrac{2}{3}$ da base para treinamento e o restante para avalia��o do algoritmo.

Amparados na an�lise estat�stica previamente realizada, elegemos um conjunto inicial de atributos que julgamos relevantes para a classifica��o: IDADE, IN\_DEFICIENCIA\_MENTAL, NOTA\_CN, NOTA\_CH, NOTA\_LC, NOTA\_MT, ESCOLA\_PRIVADA e LOCALIZACAO\_RURAL.
Em seguida, refinamos essa sele��o inicial atrav�s de experimentos envolvendo a inser��o e a remo��o de atributos, sempre utilizando $k=3$.
O conjunto de atributos que apresentou melhor resultado foi o seguinte: GENERO\_HOMEM, IDADE, IN\_DEFICIENCIA\_MENTAL, NOTA\_CN, NOTA\_CH, NOTA\_LC, NOTA\_MT e ESCOLA\_PRIVADA.
Tamb�m experimentamos multiplicar os valores de alguns atributos (em especial, notas nas provas objetivas) por n�meros reais maiores que um, de forma a atribuir-lhes maior peso, mas n�o houve melhora significativa no resultado.

Finalmente, avaliamos a acur�cia do algoritmo desenvolvido com diferentes valores de $k$.
As Fig.~\ref{fig:tab1}--\ref{fig:tab100} mostram, para todos os pares de classes $(X, Y)$, quantos candidatos da classe $X$ foram classificados como sendo da classe $Y$.
As Fig.~\ref{fig:graf1}--\ref{fig:graf100} sumarizam os tipos de erros cometidos pelo algoritmo.
Os gr�ficos evidenciam que, em geral, melhores resultados s�o obtidos com maiores valores de $k$.

\begin{figure}[H]
\centering\includegraphics[width=.60\linewidth]{plot-white1.png}
\caption{An�lise dos resultados obtidos pelo \emph{k-NN} com k=1.}
\label{fig:tab1}
\end{figure}

\begin{figure}[H]
\centering\includegraphics[width=.60\linewidth]{plot-white10.png}
\caption{An�lise dos resultados obtidos pelo \emph{k-NN} com k=10.}
\label{fig:tab10}
\end{figure}

\begin{figure}[H]
\centering\includegraphics[width=.60\linewidth]{plot-white100.png}
\caption{An�lise dos resultados obtidos pelo \emph{k-NN} com k=100.}
\label{fig:tab100}
\end{figure}

\begin{figure}[H]
\centering\includegraphics[width=.65\linewidth]{graf-white1.png}
\caption{Classifica��es por tipo de erro do \emph{k-NN} com k=1.}
\label{fig:graf1}
\end{figure}

\begin{figure}[H]
\centering\includegraphics[width=.65\linewidth]{graf-white10.png}
\caption{Classifica��es por tipo de erro do \emph{k-NN} com k=10.}
\label{fig:graf10}
\end{figure}

\begin{figure}[H]
\centering\includegraphics[width=.65\linewidth]{graf-white100.png}
\caption{Classifica��es por tipo de erro do \emph{k-NN} com k=100.}
\label{fig:graf100}
\end{figure}

\end{document}
